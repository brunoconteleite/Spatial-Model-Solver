# Spatial Model Solver

This is code that solves for the equilibrium of "my" spatial trade model. It bases upon Allen, Arkolakis (2014). I start with a version of my model without agglomeration/congestion effects on amenity utility. This is a "economy on a line" version of the model.

## Solving algorithm

For simplicity, I start with a version of the model in which <img src="/tex/cf2889bdb114fa1a6a34972c325d36bd.svg?invert_in_darkmode&sanitize=true" align=middle width=40.302373649999986pt height=22.831056599999986pt/> and <img src="/tex/3b3ab4c7f8eddc6096361d7d5269bc6d.svg?invert_in_darkmode&sanitize=true" align=middle width=45.01990349999999pt height=21.18721440000001pt/> <img src="/tex/60cd0f191d74161a0afffe3bb569399d.svg?invert_in_darkmode&sanitize=true" align=middle width=14.79567374999999pt height=22.831056599999986pt/>. Then, the equilibrium conditions would imply a system of <img src="/tex/6251b0c7ae3c532d6b603415e5a0ce66.svg?invert_in_darkmode&sanitize=true" align=middle width=43.310391299999985pt height=22.465723500000017pt/> equations as follows
<p align="center"><img src="/tex/5057afc656beeee273d7a6dec5e89a5b.svg?invert_in_darkmode&sanitize=true" align=middle width=473.86532654999996pt height=168.81070305pt/></p>
Importantly, (2) and (3) all depend on wages, so that they can be inserted into (1) so to obtain a system of N equations, which can be solved for N wages. To do so as efficient as possible, I build all functions in matrix format so that I can represent the system with a vector of equations that must equal to zero in equilibrium. As of notation, I define circled operations as element-wise ones, i.e. circled dot (slash) for element-wise multiplication (division). Element-wise power is denoted with diamond, and in line dot stands for standard matrix multiplication.


First, I calculate a <img src="/tex/7ca4de9817bb7269bc679295aee95448.svg?invert_in_darkmode&sanitize=true" align=middle width=43.31036984999999pt height=22.465723500000017pt/> vector of price indexes, given by (3), as
<p align="center"><img src="/tex/d029e3b2d968d0ba98aa5f5cae98b9fa.svg?invert_in_darkmode&sanitize=true" align=middle width=592.621062pt height=39.452455349999994pt/></p>
Note that <img src="/tex/7d388c6c33c39926775f6021fb87cf8b.svg?invert_in_darkmode&sanitize=true" align=middle width=185,2018946397pt height=24.7161288pt/>, so that the first row of <img src="/tex/5cea9b142ed75d809fab8049ed95376e.svg?invert_in_darkmode&sanitize=true" align=middle width=336,3984806031pt height=22.465723500000017pt/>. Thus, by element-wise powering both matrices to <img src="/tex/0c98e664fc362628c2e6789935f966b2.svg?invert_in_darkmode&sanitize=true" align=middle width=38.293300649999985pt height=21.18721440000001pt/> before mutiplying them and then to <img src="/tex/9f6f6916d95efbaa7604b1631fbbd9e1.svg?invert_in_darkmode&sanitize=true" align=middle width=54.731720999999986pt height=24.65753399999998pt/> after doing so, one obtains <img src="/tex/6b0d128f019dee26700d6d0fd0ff8d04.svg?invert_in_darkmode&sanitize=true" align=middle width=113.23263269999997pt height=24.65753399999998pt/>. The second step consists in calculating the equilibrium allocation of labor. The challenge there is to calculate <img src="/tex/5bbf00d9f4f4e9da23187c39f5100beb.svg?invert_in_darkmode&sanitize=true" align=middle width=14.794451099999991pt height=22.55708729999998pt/>, a symmetric matrix of bilateral probabilities <img src="/tex/73bf7fe021d7812c88c970fc2963e531.svg?invert_in_darkmode&sanitize=true" align=middle width=72.56346074999998pt height=24.65753399999998pt/>. To do so, I define
<p align="center"><img src="/tex/739602db4e61cd3a7578f941367bf711.svg?invert_in_darkmode&sanitize=true" align=middle width=259.17468225pt height=41.09589pt/></p>
Importantly, the first row of <img src="/tex/7f228b6000ff591c14353f2e3c6929ae.svg?invert_in_darkmode&sanitize=true" align=middle width=596.7355515pt height=27.91243950000002pt/>, which is exactly the denominator of <img src="/tex/7bf08879bc411f519b59cc82006db321.svg?invert_in_darkmode&sanitize=true" align=middle width=23.53224389999999pt height=22.465723500000017pt/> <img src="/tex/60cd0f191d74161a0afffe3bb569399d.svg?invert_in_darkmode&sanitize=true" align=middle width=14.79567374999999pt height=22.831056599999986pt/>. Moreover, <img src="/tex/f50853d41be7d55874e952eb0d80c53e.svg?invert_in_darkmode&sanitize=true" align=middle width=9.794543549999991pt height=22.831056599999986pt/> is almost the vector of the nominators of the same function -- each of its elements need only to be multiplied by the respective <img src="/tex/9bccc3f6ff8f1dab9e6a0add23573c12.svg?invert_in_darkmode&sanitize=true" align=middle width=26.794241099999986pt height=30.04564529999999pt/>. Thus, <img src="/tex/5bbf00d9f4f4e9da23187c39f5100beb.svg?invert_in_darkmode&sanitize=true" align=middle width=14.794451099999991pt height=22.55708729999998pt/> and <img src="/tex/80637df1ca7533740cc7b3fdd1ab540b.svg?invert_in_darkmode&sanitize=true" align=middle width=11.36979854999999pt height=22.55708729999998pt/> can be obtained as
<p align="center"><img src="/tex/62c79fea7905510cfd0a40f2f4d84855.svg?invert_in_darkmode&sanitize=true" align=middle width=573.0569459999999pt height=46.805715pt/></p>
The final step is to write the market clearing condition -- \cref{eq:ap1} -- in vector format. One can do so by noting that
<p align="center"><img src="/tex/80ee8100d1629c7fcce8feb8dd4fd821.svg?invert_in_darkmode&sanitize=true" align=middle width=493.67227139999994pt height=163.6447197pt/></p>
By defining
<p align="center"><img src="/tex/1743b6f76dfc44e50c2873f252fac1c9.svg?invert_in_darkmode&sanitize=true" align=middle width=458.45568449999996pt height=41.09589pt/></p>
one would note that its first row of <img src="/tex/b5e0cb0999744a0905180d274693fa99.svg?invert_in_darkmode&sanitize=true" align=middle width=312.7603578pt height=28.894955100000008pt/>, which is the RHS of \cref{eq:eq_cond} for <img src="/tex/081b3265e50f611c00daeffa91931873.svg?invert_in_darkmode&sanitize=true" align=middle width=35.80006649999999pt height=21.68300969999999pt/>. Then, given a certain geography -- vector of productivities, trade and migration bilateral frictions and initial labor distribution -- in equilibruim the following condition should hold:
<p align="center"><img src="/tex/8c6a080d2d43f95a998475c653e6e07b.svg?invert_in_darkmode&sanitize=true" align=middle width=515.6166345pt height=16.438356pt/></p>
To find equilibrium wages, I search for a <img src="/tex/f9c75bf2a73e8034bff58ed0c8e3c3c9.svg?invert_in_darkmode&sanitize=true" align=middle width=43.31036984999999pt height=22.465723500000017pt/> vector that minimizes the square of \cref{eq:obj_function}; thus
<p align="center"><img src="/tex/f42744c1292168b6db4359fdb2a08b64.svg?invert_in_darkmode&sanitize=true" align=middle width=492.82045559999995pt height=30.621051449999996pt/></p>
To close the solution, the equilibrium prices and labor allocations can be found by inserting <img src="/tex/89577c0279cda512158656c4e5ab7384.svg?invert_in_darkmode&sanitize=true" align=middle width=20.650659149999992pt height=22.63846199999998pt/> into \cref{eq:prices_vector,eq:transitions,eq:labormkt}.
